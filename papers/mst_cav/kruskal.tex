\subsection{Kruskal's Algorithm}
\label{sec:kruskal}

Although Kruskal's algorithm is sometimes presented as taking connected graphs and producing spanning trees, the literature also discusses the more general case of multi-component input graphs and spanning forests.  However, Kruskal has only recently been the focus of formal verification efforts, partly because it relies on the notoriously difficult-to-verify union-find algorithm; fortunately, the CertiGraph project has an existing fully-verified union-find implementation that we can leverage~\cite{DBLP:journals/pacmpl/WangCMH19}.  Kruskal also requires a sorting function; we implemented \texttt{heapsort} as explained in \S\ref{sec:heapsort}.  Kruskal is optimized for compact representations of sparse graphs, so the $O(1)$ space cost of \texttt{heapsort} is a reasonable fit.  %Including the code for union-find and heap sort, the code for Kruskal's algorithm is around 200 lines of~C.

The primary interest of our verification of Kruskal is in our proof engineering.  Kruskal inputs graphs as edge lists rather than adjacency matrices.  In addition to requiring an addition to our spatial graph predicate menu, this means that Kruskal's input graphs can have multiple edges between a given pair of vertices (\emph{i.e.}, a ``multigraph'').  Pleasingly, we can reuse most of the undirected graph definitions (\S\ref{sec:newundirected}), demonstrating that they are generic and reusable.

Another challenge is integrating the pre-existing CertiGraph verification of union-find.  We are pleased to say that no change was required for CertiGraph's existing union-find definitions, lemmas, specifications and verification.  Kruskal actually manipulates two graphs simultaneously: a directed graph with vertex labels (to store parent pointers and ranks) within union-find, and an undirected multigraph with edge labels (for which the algorithm is constructing a spanning forest).  Beyond showing that CertiGraph was capable of this kind of systems-integration challenge, we had to develop additional lemma support to bridge the directed notion of ``reachability,'' used within the directed union-find graph to the undirected notion of ``connectedness,'' used in the MSF graph (\S\ref{sec:newundirected}).

%notions of  as defined and ; with  as defined and }.

%\subsection{Reusing previously verified union-find} %%why is there such an absurdly large space?
%Kruskal's algorithm requires a union-find data structure to keep track of the state of connectedness in the partial forest. Since CertiGraph had published several verified union-find implementations, we decide to make use of them. However, as these implementations had no client using them until now, we discovered that the postconditions of the union-find calls were difficult to use for Kruskal's verification. The union-find implementations were verified prior to our introduction of undirected graph properties, thus were not designed with connectedness in mind.

%To that end, we have extended lemmas about the results of union-find operations as an analog to connectivity. We are pleased to say that no change was required for Wang's existing union-find definitions, lemmas, specifications and verification. Instead, we proved that their existing postconditions mathematically imply an analog to connectivity in undirected graphs. In other words, Wang's verified postconditions were \textit{not} incorrect or poor, they just required mathematical translation into what we wanted in the context of Kruskal's.

%We mention this to emphasise the modularity and buildability of VST and CertiGraph infrastructure - that we were able to use previously, independently proven code in a bigger system later. The internal details and verification of the union-find system are independent from that of Kruskal's, whose proof only required the preconditions and postconditions of whichever union-find implementation we decide to use.

\subsection{Related work on Kruskal in algorithms and formal methods}
\label{sec:relworkkruskal}

Joseph Kruskal published his algorithm in 1956~\cite{kruskal} and it has appeared in numerous textbooks since (\emph{e.g.},~\cite{clrs,DBLP:books/daglib/0022194,sedgewick,DBLP:books/daglib/0015106}).  Kruskal's algorithm is usually preferred over Prim's for sparse graphs, and is sometimes presented as ``the right choice'' when confronted with multi-component graphs under the mistaken assumption that Prim's first requires a component-finding initial step.

Guttman generalised minimum spanning tree algorithms using Stone relation algebras~\cite{DBLP:journals/jlp/Guttmann18}, and provided a proof of Kruskal's algorithm formatted in said algebras.  Like his work on Prim's~\cite{DBLP:conf/ictac/Guttmann16}, Guttmann works within Isabelle/HOL and does not include concrete data structures such as priority-queues and union-find, instead capturing their action as equivalence relations in the underlying algebras. In Guttmann's Kruskal paper, he mentions that his Prim paper axiomatizes the fact that ``every~finite~graph has~a~minimum~spanning~forest,'' which he is then able to prove \emph{using his Kruskal algorithm}.  Interestingly, our Prim verification needs the same fact, but we prove it directly. % that every finite graph has a finite, nonempty list of spanning forests.

In a similar vein, Haslbeck \emph{et al.} verified Kruskal's algorithm~\cite{DBLP:journals/afp/HaslbeckLB19} by building on Lammich \emph{et al.}'s earlier work on Prim~\cite{DBLP:journals/afp/LammichN19}.  Like Lammich \emph{et al.}, Haslbeck \emph{et al.} work within Isabelle/HOL with a focus on purely functional data structures.

One of the stumbling blocks in verifying Kruskal's algorithm is the need to verify union-find.  In addition to CertiGraph, 

%In Lammich et al, their Prim's implementation explicitly expects a connected graph, and they do not reason about the disconnected case.

%Working in an idealized formal environment, they do not require the development of .

%\note{Despite this connectedness requirement, Guttman stated in a subsequent paper~\cite{DBLP:journals/jlp/Guttmann18} that his proof of Prim in~\cite{DBLP:conf/ictac/Guttmann16} asserts that  as an axiom.}

%Guttman later proved this by relying on their proof of Kruskal's. We use the same assertion in our proof of Prim's, but in our case, Kruskal's is defined in the spatial layer of our library, not the mathematical-layer, and it would be unwieldy to bring it back up. Instead, we show in the mathematical layer that  Thus there exists a minimum spanning forest by simply taking the minimal-weight forest in this list. 