\begin{figure}[t]
  \begin{lstlisting}
struct Node {$\label{code:nodedefstart}$
  int  _Alignas(16) m;
  struct Node * _Alignas(8) l;
  struct Node * r; };$\label{code:nodedefend}$

void mark(struct Node * x) { // $\label{code:markstart}\{\p{graph}(\tx{x},\gamma)\}$
  struct Node * l, * r; int root_mark; $\label{code:inmark}$
  if (x == 0) return;
// $\{\p{graph}(\tx x,\gamma) /| \exists m,l,r.~ \gamma(\tx{x}) = (m,l,r)\}$
// $\label{code:globalbeforerootmark}\{\p{graph}(\tx x,\gamma) /| \gamma(\tx{x}) = (m,l,r)\}$
// $\label{code:beforerootmark}\searrow \{\tx x|-> m,-,l,r \}$
$\label{code:markram1}$      root_mark = x -> m;
// $\label{code:afterrootmark}\swarrow \{\tx x|-> m,-,l,r /| m = \tx{root\_mark} \}$
// $\label{code:globalafterrootmark}\{\p{graph}(\tx x,\gamma) /| \gamma(\tx{x}) = (m,l,r) /| m = \tx{root\_mark}\}$
  if (root_mark == 1) return;
// $\{\p{graph}(\tx x,\gamma) /| \gamma(\tx{x}) = (0,l,r) \}$
// $\label{code:markbeforetripleramify}\searrow \{\tx x|-> 0,-,l,r /| \gamma(\tx{x}) = (0,l,r)\}$
      l = x -> l;
$\label{code:markram2}\ramify(\ref{lem:updategraphnode})$      r = x -> r;
      x -> m = 1;
// $\label{code:markaftertripleramify}\swarrow \{\tx x|-> 1,-,\tx{l},\tx{r} /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \exists \gamma'.~ \m{mark1}(\gamma, \tx{x}, \gamma')\}$
// $\{\exists \gamma'.~ \p{graph}(\tx x,\gamma') /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \m{mark1}(\gamma, \tx{x}, \gamma')\}$
// $\label{code:beforemarkl}\{\p{graph}(\tx x,\gamma') /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \m{mark1}(\gamma, \tx{x}, \gamma')\}$
// $\searrow \{\p{graph}(\tx l, \gamma')\}$
$\label{code:markram3}\ramify(\ref{lem:updatesubgraph})$      mark(l);
// $\swarrow \{\exists \gamma''.~ \p{graph}(\tx l, \gamma'') /| \m{mark}(\gamma', \tx{l}, \gamma'')\}$
// $\label{code:aftermarkl}\left\{\!\!\!\begin{array}{l@{}}\exists \gamma''.~ \p{graph}(\tx x,\gamma'') /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \null \\ \m{mark1}(\gamma, \tx{x}, \gamma') /| \m{mark}(\gamma', \tx{l}, \gamma'')\end{array}\right\}$
// $\left\{\!\!\!\begin{array}{l@{}}\p{graph}(\tx x,\gamma'') /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \null \\ \m{mark1}(\gamma, \tx{x}, \gamma') /| \m{mark}(\gamma', \tx{l}, \gamma'')\end{array}\right\}$
// $\searrow \{\p{graph}(\tx r, \gamma'')\}$
$\label{code:markram4}\ramify(\ref{lem:updatesubgraph})$      mark(r);
// $\swarrow \{\exists \gamma'''.~ \p{graph}(\tx r, \gamma''') /| \m{mark}(\gamma'', \tx{r}, \gamma''')\}$
// $\label{code:outmark}\left\{\!\!\!\begin{array}{l@{}}\exists \gamma'''.~ \p{graph}(\tx x,\gamma''') /| \gamma(\tx{x}) = (0,\tx{l},\tx{r}) /| \null \\ \m{mark1}(\gamma, \tx{x}, \gamma') /| \m{mark}(\gamma', \tx{l}, \gamma'') /| \m{mark}(\gamma'', \tx{r}, \gamma''')\end{array}\right\}$
} // $\label{code:markend}\{\exists \gamma'''.~ \p{graph}(\tx x,\gamma''') /| \m{mark}(\gamma, \tx{x}, \gamma''')\}$
\end{lstlisting}
%% \vspace{-8pt}
\caption{Clight code and proof sketch for bigraph mark.}
% {\color{magenta} The steps that induce
%  ramifications are indicated with $\ramify_i$, where the associated ramification entailment is equation number $i$.}} %whose numbers point with their associated ramification entailment reference.}
%\vspace{-19pt}
\label{fig:markgraph}
\end{figure}
