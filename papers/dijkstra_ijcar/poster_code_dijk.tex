
\begin{figure}[t]

\begin{lstlisting}[mathescape=true,showlines=true]
void dijkstra (int **graph, int src, int *dist, 
               int *prev, int size, int inf {
$\color{OliveGreen}//~\braces{\p{AdjMat}(\gamma) *
\mathsf{array}(\texttt{dist}, \_) * \mathsf{array}(\texttt{prev}, \_)}$
 int pq = init(size); int i, j, u, cost;
 for (i = 0; i < size; i++)
 {  dist[i] = inf; prev[i] = inf; push(i, inf, pq);  }
 dist[src] = 0; prev[src] = src; dec_key(src, 0, pq);
$\color{OliveGreen}//~\braces{{\color{red}\exists \m{priq}, \m{dist}, \m{prev}}.~\p{AdjMat}(\gamma) * {\color{red}\mathsf{PQ}(\texttt{pq},\m{priq})} * \mathsf{array}(\texttt{dist},{\color{red}\m{dist}}) * \null \\ \mathsf{array}(\texttt{prev}, {\color{red}\m{prev}}) /|
{\color{red}\m{dijk\_correct}(\gamma,\texttt{src},\texttt{[]},\m{prev},\m{dist})}}$ $\label{code:whileinv}$
 while (!pq_emp(size, inf, pq)) {
  u = pop_min(size, inf, pq); $\label{code:pop}$
$\color{OliveGreen}//~\braces{\exists \m{prev'}, \m{dist'}, \m{priq'}.~\p{AdjMat}(\gamma) *
\mathsf{PQ}(\texttt{pq},\m{priq'}) * \mathsf{array}(\texttt{dist},\m{dist'}) * \null \\ \mathsf{array}(\texttt{prev}, \m{prev'}) /| \texttt{u} \in \m{popped}(\m{priq'}) /| \null \\
\m{dijk\_correct\_weak}(\gamma, \texttt{src}, \m{prev'}, \m{dist'}, \m{priq'}, \texttt{i}, \texttt{u})}$ $\label{code:forinv}$
  for (i = 0; i < size; i++) {
   cost = getCell(graph, u, i); $\label{code:cost}$
   if (cost < inf) {
    if (dist[i] > dist[u] + cost) { $\label{code:overflow}$
     dist[i] = dist[u] + cost; prev[i] = u; $\label{code:update1}$ 
     dec_key(i, dist[i], pq); $\label{code:update2}$
    }
   } $\color{OliveGreen}//~\braces{\exists \m{prev'}, \m{dist'}, \m{priq'}.~\p{AdjMat}(\gamma) * \mathsf{PQ}(\texttt{pq},\m{priq'}) * \mathsf{array}(\texttt{dist},\m{dist'}) * \null \\ \mathsf{array}(\texttt{prev}, \m{prev'}) /| \m{dijk\_correct\_weak}(\gamma, \texttt{src}, \m{prev'}, \m{dist'}, \m{priq'}, \texttt{i}, \texttt{u})}$
  } $\color{OliveGreen}//~\braces{\exists \m{prev'}, \m{dist'}, \m{priq'}.~\p{AdjMat}(\gamma) * \mathsf{PQ}(\texttt{pq},\m{priq'}) * \mathsf{array}(\texttt{dist},\m{dist'}) * \null \\ \mathsf{array}(\texttt{prev}, \m{prev'}) /| \m{dijk\_correct}(\gamma, \texttt{src}, \m{prev'}, \m{dist'}, \m{priq'})}$
 } $\color{OliveGreen}//~\braces{\exists \m{priq}, \m{dist}, \m{prev}.~\p{AdjMat}(\gamma) * \mathsf{PQ}(\texttt{pq},\m{priq}) * \mathsf{array}(\texttt{dist},\m{dist}) * \null \\ \mathsf{array}(\texttt{prev}, \m{prev}) /|
\forall \m{dst} \in \m{priq}.~\m{priq}[\m{dst}] \not< \texttt{inf} /| \null \\
\m{dijk\_correct}(\gamma,\texttt{src},\m{prev},\m{dist},\m{priq})}$
 freePQ (pq); return; 
}
\end{lstlisting}
\vspace{-1em}
\caption{Clight code and proof sketch for Dijkstra's Algorithm}
\vspace{-1em}
\label{fig:decorated}
\end{figure} 