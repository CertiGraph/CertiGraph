
Figure~\ref{fig:decorated} shows the code and proof
sketch of Dijkstra's algorithm. 
The code is implemented exactly as suggested 
by~\cite{clrs}, and so we elide a discussion 
of the algorithm itself. The heart of the formal verification is in the 
while loop's invariant, which is stated on line~\ref{code:whileinv}
and explained further in Figure~\ref{fig:defns}.
The source vertex $\m{src}$ is taken as a parameter. 
A destination vertex $\m{dst}$ falls into one of three
categories, and subsequently obeys one of three invariants:
\begin{enumerate}
\item $\m{inv\_popped}$: $\m{dst}$ has been fully processed, and has been
popped from the priority queue. 
A globally optimal path from $\m{src}$ 
to $\m{dst}$ exists, the cost of this path is logged in 
the \texttt{dist} array, and all the vertices visited by the path are also popped.
Further, the links of this path are correctly logged in the \texttt{prev} array.
\item $\m{inv\_unpopped}$: $\m{dst}$ is reachable in 
one hop from a ``\emph{mom}'' vertex, which is itself popped. 
This route is locally optimal: we cannot 
improve the cost by going via a \emph{different} popped vertex.
The \texttt{prev} array logs
\emph{mom} as the best-known way to reach $\m{dst}$, and the \texttt{dist}
array logs the cost of the path via \emph{mom} as the best-known cost.
\item $\m{inv\_unseen}$: no path is currently known from $\m{src}$ to $\m{dst}$.
\end{enumerate}

This three-part invariant is trivially true before the while loop. 
On line~\ref{code:pop}, the minimal vertex from the priority queue is popped, 
thus breaking the invariant.

First, we must show that the minimal vertex $\m{u}$ 
obeys $\m{inv\_popped}$. \emph{i.e.}, show that the locally 
optimal path to $\m{u}$ is, in fact, globally optimal. 
This comes from blah blah blah

\newcommand{\s}{11}
\begin{figure}[htbp]
  \centering
  \begin{tikzpicture}[x=0.3cm, y=0.3cm,
      popped/.style={rounded corners=5pt, line width=1pt, draw, fill=MidnightBlue},
      fringe/.style={rounded corners=5pt, line width=1pt, draw, fill=ProcessBlue},
      popping/.style={rounded corners=5pt, line width=1pt, draw, dashed, fill=pink},
      unseen/.style={rounded corners=5pt, line width=1pt, draw}]
    \draw[unseen] (0,0) -- (\s,0) -- (\s,\s) -- (0,\s) -- cycle;
    \draw[fringe] (1.5,1.5) -- (9.5,1.5) -- (9.5,9.5) -- (1.5,9.5) -- cycle;
    \draw[popped] (3,3) -- (8,3) -- (6,6) -- (3,8) -- cycle;
    \node at (1.4,1) {dst$_3$};   
    \node at (2.9,2.5) {dst$_2$};   
    \node at (4.4,4) {\color{white}dst$_1$}; 
    \node at (6.6,7) {u};
    \tikzset{shift={(13.5,0)}}

    \draw[unseen] (0,0) -- (\s,0) -- (\s,\s) -- (0,\s) -- cycle;
    \draw[fringe] (1.5,1.5) -- (9.5,1.5) -- (9.5,9.5) -- (1.5,9.5) -- cycle;
    \draw[popping] (3,3) -- (8,3) -- (8,8) -- (3,8) -- cycle;
    \draw[popped] (3,3) -- (8,3) -- (6,6) -- (3,8) -- cycle;
    \node at (1.4,1) {dst$_3$};   
    \node at (2.9,2.5) {dst$_2$};   
    \node at (4.4,4) {\color{white}dst$_1$}; 
    \node at (6.6,7) {u};     

    \tikzset{shift={(13.5,0)}}

    \draw[unseen] (0,0) -- (\s,0) -- (\s,\s) -- (0,\s) -- cycle;
    \draw[fringe] (1.5,1.5) -- (9.5,1.5) -- (9.5,9.5) -- (1.5,9.5) -- cycle;
    \draw[popped] (3,3) -- (8,3) -- (8,8) -- (3,8) -- cycle;
    \node at (1.4,1) {dst$_3$};   
    \node at (2.9,2.5) {dst$_2$};   
    \node at (4.4,4) {\color{white}dst$_1$}; 
    \node at (6.6,7) {\color{white}u};       
  \end{tikzpicture}
  \caption{Popping $\m{u}$}  
\end{figure}

Next, we must account for the ripple effect that popping 
$\m{u}$ could have had on the other vertices. 
In particular, it is possible that a vertex obeying $\m{inv\_unpopped}$ can
improve its cost via $\m{u}$, and that an unreachable vertex 
obeying $\m{inv\_unseen}$ can now be reached via $\m{u}$. 
The for loop repairs these breakages by 
checking if a path via $\m{u}$ is an improvement for such vertices, and, if so, 
edits both arrays and the priority queue as seen on line~\ref{code:update}.

The for loop's invariant is similar to that of the while loop---$\m{inv\_unseen}$ 
and $\m{inv\_popped}$ are preserved as-is, modulo the popping of 
$\m{u}$ as discussed above. The key edit is in $\m{inv\_unpopped}$. blah blah blah

\input{poster_code_dijk.tex}

