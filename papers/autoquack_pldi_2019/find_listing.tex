\begin{figure}[t]
\vspace{-1ex}
  \begin{lstlisting}
struct Node { $\label{code:nodedefstart}$
  unsigned int rank;
  struct Node * parent; $\label{code:nodedefstart}$
  }

struct Node* find(struct Node* x) {//$\label{code:findstart}\{\p{graph}(\gamma) /| \tx{x}\in\m{V}(\gamma)\}$
  struct Node *p;
// $\{\p{graph}(\gamma) /| \tx{x}\in\m{V}(\gamma) /| \exists\m{rnk},\m{par}.~\gamma(\tx{x}) = (\m{rnk}, \m{par}) /| \m{par}\in\m{V}(\gamma) \}$
// $\label{code:befparentfind}\searrow\{\tx{x}|-> \m{rnk},\m{par} /| \tx{x}\in\m{V}(\gamma) /| \gamma(\tx{x}) = (\m{rnk}, \m{par}) /| \m{par}\in\m{V}(\gamma)\}$
  p = x -> parent; $\label{code:findram1}$
// $\label{code:aftparentfind}\swarrow \{\tx{x}|-> \m{rnk},\m{par} /| \tx{p} = \m{par} /| \tx{x}\in\m{V}(\gamma) /| \gamma(\tx{x}) = (\m{rnk}, \m{par}) /| \tx{p}\in\m{V}(\gamma)\}$
// $\{\p{graph}(\gamma) /| \tx{p} = \m{par} /| \tx{x}\in\m{V}(\gamma) /| \gamma(\tx{x}) = (\m{rnk},\m{par}) /| \tx{p}\in\m{V}(\gamma)\}$ 
  if (p != x) {
// $\label{code:findbeforereassign} \{\p{graph}(\gamma) /| \tx{p} = \m{par} /| \m{par} \neq \tx{x} /| \tx{x}\in\m{V}(\gamma) /| \gamma(\tx{x}) = (\m{rnk}, \m{par}) /| \tx{p}\in\m{V}(\gamma)\}$
    p = find(p); 
// $\left\{\!\!\!\begin{array}{l@{}}\exists \gamma',\m{rt}.~\p{graph}(\gamma') /| \tx{p} = \m{rt} /| \m{par} \neq \tx{x} /| \m{findS}(\gamma,\m{par},\gamma') /| \null \\ \m{uf\_root}(\gamma',\m{par},\m{rt}) /| \tx{x}\in\m{V}(\gamma) /| \gamma(\tx{x})=(\m{rnk},\m{par})\end{array}\right\}$
// $\left\{\!\!\!\begin{array}{l@{}}\p{graph}(\gamma') /| \tx{p} = \m{rt} /| \m{par} \neq \tx{x} /| \m{findS}(\gamma, \m{par}, \gamma') /| \null \\ \m{uf\_root}(\gamma',\m{par},\m{rt}) /| \tx{x}\in\m{V}(\gamma') /| \gamma'(\tx{x})=(\m{rnk}, \m{par}) /| \null \\ \m{V}(\gamma') = \m{V}(\m{ggrp}(\gamma',\tx{x},\m{rt}))\end{array}\right\}$
// $\label{code:findbeforexparent}\searrow \left\{\!\!\!\!\begin{array}{l@{}}\tx{x} |-> \m{rnk},{par} /| \tx{p} = \m{rt} /| \m{par} \neq \tx{x} /| \m{findS}(\gamma, \m{par}, \gamma') /| \null \\ \m{uf\_root}(\gamma',\m{par},rt) /| \tx{x}\in\m{V}(\gamma') /| \gamma'(\tx{x})=(\m{rnk}, \m{par}) /| \null \\ \m{V}(\gamma') = \m{V}(\m{ggrp}(\gamma',\tx{x},\m{rt}))\end{array}\right\}$
    x -> parent = p;
// $\label{code:findafterxparent}\swarrow \left\{\!\!\!\!\!\begin{array}{l@{}}\tx{x} |-> \m{rnk},\m{rt} /| \tx{p} = \m{rt} /| \m{par} \neq \tx{x} /| \m{findS}(\gamma, \m{par}, \gamma') /| \null \\ \m{uf\_root}(\gamma',\m{par},rt) /| \tx{x}\in\m{V}(\gamma') /| \gamma'(\tx{x})=(\m{rnk}, \m{par}) /| \null \\ \m{V}(\gamma') = \m{V}(\m{ggrp}(\gamma',\tx{x},\m{rt}))\end{array}\right\}$
// ?? $\left\{\!\!\!\!\!\begin{array}{l@{}} \p{graph}(\gamma'') /| \tx{p} = \m{rt} /| \m{par} \neq \tx{x} /| \m{findS}(\gamma, \m{par}, \gamma') /| \null \\ \m{uf\_root}(\gamma',\m{par},rt) /| \tx{x}\in\m{V}(\gamma') /| \null \\ \gamma'(\tx{x})=(\m{rnk}, \m{par}) /| \neg\m{reachable}(\gamma', \m{rt}, \tx{x}) /| \null \\ \gamma'' = \m{ggrp}(\gamma',\tx{x},\m{rt}) /| \m{findS}(\gamma, \tx{p}, \gamma'') /| \null \\ \m{uf\_root}(\gamma'',\tx{p},rt)\end{array}\right\}$
  } 
  return p;
} // $\left\{\!\!\!\!\!\begin{array}{l@{}} \exists \gamma'',\m{rt}.~\p{graph}(\gamma'') /| \m{findS}(\gamma, \tx{x}, \gamma'') /| \null \\\m{uf\_root}(\gamma'',\tx{x},\m{rt}) /| \tx{ret} = \m{rt}  \end{array}\right\}$ 
\end{lstlisting}

% need to have some notion of findS down below. probably want to define it at a higher level than what I've reproduced below?

%  Definition uf_root (pg: PreGraph Vertex Edge) (x root: Vertex) : Prop := reachable pg x root /\ (forall y, reachable pg root y -> root = y).

%  Definition uf_equiv (g1 g2: PreGraph Vertex Edge) : Prop :=
%    (forall x, vvalid g1 x <-> vvalid g2 x) /\ (forall x r1 r2, uf_root g1 x r1 -> uf_root g2 x r2 -> r1 = r2).

%  Definition rank_unchanged (g1 g2: Graph) : Prop := forall v, vvalid g1 v -> vvalid g2 v -> vlabel g1 v = vlabel g2 v.

%  Definition findS (g1: Graph) (x: Vertex) (g2: Graph) :=
%    (predicate_partialgraph g1 (fun n => ~ reachable g1 x n)) ~=~ (predicate_partialgraph g2 (fun n => ~ reachable g1 x n)) /\ uf_equiv g1 g2 /\ rank_unchanged g1 g2. (**) why isn't uf_equiv enough?

% can replace rnk with _ instead of ex it

\vspace{-0.4em}
\caption{Clight code and proof sketch for find}
\label{fig:find}
\vspace{-1em}
\end{figure}